<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NyelvtanulÃ³ â€“ OpenAI TTS</title>

<style>
body { font-family:-apple-system,BlinkMacSystemFont,sans-serif; padding:20px; }
input, select, button { width:100%; padding:12px; margin-top:8px; font-size:16px; }
button { background:#007AFF; color:white; border:none; border-radius:8px; }
button.secondary { background:#888; }
.list div { padding:3px 0; }
hr { margin:24px 0; }
</style>
</head>

<body>

<h2>ğŸŒ Idegen nyelv</h2>
<select id="langSelect">
  <option value="it">ğŸ‡®ğŸ‡¹ Olasz</option>
  <option value="en">ğŸ‡¬ğŸ‡§ Angol</option>
  <option value="fr">ğŸ‡«ğŸ‡· Francia</option>
  <option value="de">ğŸ‡©ğŸ‡ª NÃ©met</option>
  <option value="es">ğŸ‡ªğŸ‡¸ Spanyol</option>
</select>

<h2>ğŸ“ SzÃ³csoport</h2>
<input id="groupInput" placeholder="SzÃ³csoport neve">
<button id="createGroupBtn">SzÃ³csoport lÃ©trehozÃ¡sa</button>
<select id="groupSelect"></select>

<hr>

<h3>â• Ãšj szÃ³</h3>
<input id="foreignInput" placeholder="Idegen szÃ³ / kifejezÃ©s">
<input id="huInput" placeholder="Magyar jelentÃ©s">
<button id="addWordBtn">SzÃ³ hozzÃ¡adÃ¡sa</button>

<div class="list" id="wordList"></div>

<hr>

<h3>â–¶ï¸ LejÃ¡tszÃ¡s</h3>
<input id="delayInput" type="number" value="3">
<input id="repeatInput" type="number" value="2">

<button id="startBtn">START</button>
<button class="secondary" id="pauseBtn">PAUSE</button>
<button class="secondary" id="resumeBtn">RESUME</button>
<button class="secondary" id="stopBtn">STOP</button>

<script>
/* ===================== BEÃLLÃTÃS ===================== */
const OPENAI_API_KEY = "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";

/* ===================== ÃLLAPOT ===================== */
let data = JSON.parse(localStorage.getItem("wordDataOpenAI") || "{}");
let playing = false;
let paused = false;

/* ===================== DOM ===================== */
const groupInput = document.getElementById("groupInput");
const groupSelect = document.getElementById("groupSelect");
const foreignInput = document.getElementById("foreignInput");
const huInput = document.getElementById("huInput");
const wordList = document.getElementById("wordList");
const langSelect = document.getElementById("langSelect");
const delayInput = document.getElementById("delayInput");
const repeatInput = document.getElementById("repeatInput");

/* ===================== SEGÃ‰D ===================== */
function save() {
  localStorage.setItem("wordDataOpenAI", JSON.stringify(data));
}

function refreshGroups() {
  groupSelect.innerHTML = "";
  Object.keys(data).forEach(g => {
    const o = document.createElement("option");
    o.value = g;
    o.textContent = `${g} (${data[g].lang})`;
    groupSelect.appendChild(o);
  });
  renderWords();
}

function renderWords() {
  wordList.innerHTML = "";
  const g = groupSelect.value;
  if (!g) return;
  data[g].words.forEach(w => {
    const d = document.createElement("div");
    d.textContent = `${w.f} â€“ ${w.h}`;
    wordList.appendChild(d);
  });
}

function shuffle(arr) {
  return arr.slice().sort(() => Math.random() - 0.5);
}

async function speak(text, lang) {
  const res = await fetch("https://api.openai.com/v1/audio/speech", {
    method: "POST",
    headers: {
      "Authorization": "Bearer " + OPENAI_API_KEY,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      model: "gpt-4o-mini-tts",
      voice: "alloy",
      input: text,
      language: lang
    })
  });

  const blob = await res.blob();
  const url = URL.createObjectURL(blob);
  const audio = new Audio(url);

  return new Promise(r => {
    audio.onended = r;
    audio.play();
  });
}

function wait(sec) {
  return new Promise(async r => {
    while (paused) await new Promise(x => setTimeout(x,200));
    setTimeout(r, sec*1000);
  });
}

/* ===================== ESEMÃ‰NYEK ===================== */
document.getElementById("createGroupBtn").onclick = () => {
  const name = groupInput.value.trim();
  if (!name || data[name]) return alert("HibÃ¡s vagy lÃ©tezÅ‘ nÃ©v");
  data[name] = { lang: langSelect.value, words: [] };
  save();
  refreshGroups();
  groupSelect.value = name;
  groupInput.value = "";
};

document.getElementById("addWordBtn").onclick = () => {
  const g = groupSelect.value;
  if (!g) return;
  data[g].words.push({ f: foreignInput.value.trim(), h: huInput.value.trim() });
  save();
  foreignInput.value = huInput.value = "";
  renderWords();
};

document.getElementById("startBtn").onclick = async () => {
  const g = groupSelect.value;
  if (!g) return;
  playing = true;
  paused = false;

  const delay = Number(delayInput.value);
  const repeat = Number(repeatInput.value);
  const lang = data[g].lang;
  const words = shuffle(data[g].words);

  for (const w of words) {
    if (!playing) break;
    for (let i=0;i<repeat;i++) {
      await speak(w.f, lang);
      await wait(delay);
      await speak(w.h, "hu");
      await wait(delay);
    }
  }
};

document.getElementById("pauseBtn").onclick = () => paused = true;
document.getElementById("resumeBtn").onclick = () => paused = false;
document.getElementById("stopBtn").onclick = () => { playing=false; paused=false; };

groupSelect.onchange = renderWords;

refreshGroups();
</script>

</body>
</html>
