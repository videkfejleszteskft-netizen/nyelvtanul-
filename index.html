<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NyelvtanulÃ³ â€“ stabil hang</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  padding: 20px;
}
input, select, button {
  width: 100%;
  padding: 12px;
  margin-top: 8px;
  font-size: 16px;
}
button {
  background: #007AFF;
  color: white;
  border: none;
  border-radius: 8px;
}
button.secondary { background: #888; }
hr { margin: 24px 0; }
.list div { padding: 3px 0; }
</style>
</head>

<body>

<h2>ğŸŒ Idegen nyelv (szÃ³csoporthoz kÃ¶tve)</h2>
<select id="langSelect">
  <option value="it-IT">ğŸ‡®ğŸ‡¹ Olasz</option>
  <option value="en-US">ğŸ‡¬ğŸ‡§ Angol</option>
  <option value="fr-FR">ğŸ‡«ğŸ‡· Francia</option>
  <option value="de-DE">ğŸ‡©ğŸ‡ª NÃ©met</option>
  <option value="es-ES">ğŸ‡ªğŸ‡¸ Spanyol</option>
</select>

<h2>ğŸ“ SzÃ³csoport lÃ©trehozÃ¡sa</h2>
<input id="groupInput" placeholder="SzÃ³csoport neve">
<button id="createGroupBtn">SzÃ³csoport lÃ©trehozÃ¡sa</button>

<select id="groupSelect"></select>

<hr>

<h3>â• Ãšj szÃ³</h3>
<input id="foreignInput" placeholder="Idegen szÃ³ / kifejezÃ©s">
<input id="huInput" placeholder="Magyar jelentÃ©s">
<button id="addWordBtn">SzÃ³ hozzÃ¡adÃ¡sa</button>

<div class="list" id="wordList"></div>

<hr>

<h3>â–¶ï¸ LejÃ¡tszÃ¡s</h3>
<input id="delayInput" type="number" value="3">
<input id="repeatInput" type="number" value="3">

<button id="startBtn">START</button>
<button class="secondary" id="pauseBtn">PAUSE</button>
<button class="secondary" id="resumeBtn">RESUME</button>
<button class="secondary" id="stopBtn">STOP</button>

<script>
/* ===== VOICE ===== */
let voices = [];
function loadVoices() {
  voices = speechSynthesis.getVoices();
}
speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

function getVoice(lang) {
  return voices.find(v => v.lang === lang) || null;
}

/* ===== DATA ===== */
let data = JSON.parse(localStorage.getItem("wordDataV3") || "{}");
let playing = false;
let paused = false;

/* ===== DOM ===== */
const groupInput = document.getElementById("groupInput");
const groupSelect = document.getElementById("groupSelect");
const foreignInput = document.getElementById("foreignInput");
const huInput = document.getElementById("huInput");
const wordList = document.getElementById("wordList");
const langSelect = document.getElementById("langSelect");
const delayInput = document.getElementById("delayInput");
const repeatInput = document.getElementById("repeatInput");

/* ===== UTILS ===== */
function save() {
  localStorage.setItem("wordDataV3", JSON.stringify(data));
}

function refreshGroups() {
  groupSelect.innerHTML = "";
  Object.keys(data).forEach(g => {
    const o = document.createElement("option");
    o.value = g;
    o.textContent = `${g} (${data[g].lang})`;
    groupSelect.appendChild(o);
  });
  renderWords();
}

function renderWords() {
  wordList.innerHTML = "";
  const g = groupSelect.value;
  if (!g) return;
  data[g].words.forEach(w => {
    const d = document.createElement("div");
    d.textContent = `${w.f} â€“ ${w.h}`;
    wordList.appendChild(d);
  });
}

function shuffle(arr) {
  return arr.slice().sort(() => Math.random() - 0.5);
}

/* ===== SPEAK ===== */
function speak(text, lang) {
  return new Promise(resolve => {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = lang;
    const v = getVoice(lang);
    if (v) u.voice = v;
    u.rate = 0.9;
    u.onend = resolve;
    speechSynthesis.speak(u);
  });
}

function wait(sec) {
  return new Promise(async r => {
    while (paused) await new Promise(x => setTimeout(x, 200));
    setTimeout(r, sec * 1000);
  });
}

/* ===== EVENTS ===== */
document.getElementById("createGroupBtn").onclick = () => {
  const name = groupInput.value.trim();
  if (!name || data[name]) return alert("HibÃ¡s vagy lÃ©tezÅ‘ nÃ©v");
  data[name] = {
    lang: langSelect.value,
    words: []
  };
  save();
  refreshGroups();
  groupSelect.value = name;
  groupInput.value = "";
};

document.getElementById("addWordBtn").onclick = () => {
  const g = groupSelect.value;
  if (!g) return alert("Nincs szÃ³csoport");
  data[g].words.push({
    f: foreignInput.value.trim(),
    h: huInput.value.trim()
  });
  save();
  foreignInput.value = huInput.value = "";
  renderWords();
};

document.getElementById("startBtn").onclick = async () => {
  const g = groupSelect.value;
  if (!g) return;
  playing = true;
  paused = false;
  speechSynthesis.cancel();

  const lang = data[g].lang;
  const words = shuffle(data[g].words);
  const delay = Number(delayInput.value);
  const repeat = Number(repeatInput.value);

  for (const w of words) {
    if (!playing) break;

    for (let i = 0; i < repeat; i++) {
      await speak(w.f, lang);
      await wait(delay);
      await speak(w.h, "hu-HU");
      await wait(delay);
    }
  }
};

document.getElementById("pauseBtn").onclick = () => {
  paused = true;
  speechSynthesis.pause();
};
document.getElementById("resumeBtn").onclick = () => {
  paused = false;
  speechSynthesis.resume();
};
document.getElementById("stopBtn").onclick = () => {
  playing = false;
  paused = false;
  speechSynthesis.cancel();
};

groupSelect.onchange = renderWords;

refreshGroups();
</script>

</body>
</html>
