<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NyelvtanulÃ³ â€“ nyelvvÃ¡lasztÃ³</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  padding: 20px;
}
h2, h3 {
  margin-top: 20px;
}
input, select, button {
  width: 100%;
  padding: 12px;
  margin-top: 8px;
  font-size: 16px;
}
button {
  background: #007AFF;
  color: white;
  border: none;
  border-radius: 8px;
}
button.secondary {
  background: #888;
}
.controls button {
  margin-top: 10px;
}
.list {
  margin-top: 10px;
  font-size: 15px;
}
.list div {
  padding: 3px 0;
}
hr {
  margin-top: 25px;
}
</style>
</head>

<body>

<h2>ğŸŒ Idegen nyelv</h2>
<select id="langSelect">
  <option value="it-IT">ğŸ‡®ğŸ‡¹ Olasz</option>
  <option value="en-US">ğŸ‡¬ğŸ‡§ Angol</option>
  <option value="fr-FR">ğŸ‡«ğŸ‡· Francia</option>
  <option value="de-DE">ğŸ‡©ğŸ‡ª NÃ©met</option>
  <option value="es-ES">ğŸ‡ªğŸ‡¸ Spanyol</option>
</select>

<h2>ğŸ“ SzÃ³csoportok</h2>

<input id="groupInput" placeholder="Ãšj szÃ³csoport neve">
<button id="createGroupBtn">SzÃ³csoport lÃ©trehozÃ¡sa</button>

<select id="groupSelect"></select>

<hr>

<h3>â• Ãšj szÃ³</h3>

<input id="foreignInput" placeholder="Idegen szÃ³ / kifejezÃ©s">
<input id="huInput" placeholder="Magyar jelentÃ©s">
<button id="addWordBtn">SzÃ³ hozzÃ¡adÃ¡sa</button>

<div class="list" id="wordList"></div>

<hr>

<h3>â–¶ï¸ LejÃ¡tszÃ¡s</h3>

<input id="delayInput" type="number" value="3" placeholder="SzÃ¼net (mp)">
<input id="repeatInput" type="number" value="3" placeholder="IsmÃ©tlÃ©sek szÃ¡ma">

<div class="controls">
  <button id="startBtn">START</button>
  <button class="secondary" id="pauseBtn">PAUSE</button>
  <button class="secondary" id="resumeBtn">RESUME</button>
  <button class="secondary" id="stopBtn">STOP</button>
</div>

<script>
/* ===== DOM ===== */
const groupInput = document.getElementById("groupInput");
const groupSelect = document.getElementById("groupSelect");
const foreignInput = document.getElementById("foreignInput");
const huInput = document.getElementById("huInput");
const wordList = document.getElementById("wordList");
const delayInput = document.getElementById("delayInput");
const repeatInput = document.getElementById("repeatInput");
const langSelect = document.getElementById("langSelect");

/* ===== ADAT ===== */
let data = JSON.parse(localStorage.getItem("wordData") || {});
let playing = false;
let paused = false;

/* ===== SEGÃ‰D ===== */
function save() {
  localStorage.setItem("wordData", JSON.stringify(data));
}

function refreshGroups() {
  groupSelect.innerHTML = "";
  Object.keys(data).forEach(name => {
    const opt = document.createElement("option");
    opt.value = name;
    opt.textContent = name;
    groupSelect.appendChild(opt);
  });
  renderWords();
}

function renderWords() {
  wordList.innerHTML = "";
  const g = groupSelect.value;
  if (!g || !data[g]) return;
  data[g].forEach(pair => {
    const d = document.createElement("div");
    d.textContent = `${pair.foreign} â€“ ${pair.hu}`;
    wordList.appendChild(d);
  });
}

/* ===== RANDOM ===== */
function shuffle(arr) {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

/* ===== BESZÃ‰D ===== */
function speak(text, lang) {
  return new Promise(resolve => {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = lang;
    u.rate = 0.9;
    u.pitch = 1.0;
    u.onend = resolve;
    speechSynthesis.speak(u);
  });
}

function wait(sec) {
  return new Promise(async resolve => {
    while (paused) await new Promise(r => setTimeout(r, 200));
    setTimeout(resolve, sec * 1000);
  });
}

/* ===== LEJÃTSZÃS ===== */
async function startPlayback() {
  const g = groupSelect.value;
  if (!g || !data[g] || data[g].length === 0) {
    alert("Nincs lejÃ¡tszhatÃ³ szÃ³!");
    return;
  }

  playing = true;
  paused = false;
  speechSynthesis.cancel();

  const delay = Number(delayInput.value);
  const repeat = Number(repeatInput.value);
  const foreignLang = langSelect.value;

  const words = shuffle(data[g]);

  for (const w of words) {
    if (!playing) break;

    for (let i = 0; i < repeat; i++) {
      await speak(w.foreign, foreignLang);
      await wait(delay);
      await speak(w.hu, "hu-HU");
      await wait(delay);
    }

    for (let i = 0; i < repeat; i++) {
      await speak(w.foreign, foreignLang);
      await wait(delay);
      await speak(w.hu, "hu-HU");
      await wait(delay);
    }
  }
}

/* ===== GOMBOK ===== */
document.getElementById("createGroupBtn").onclick = () => {
  const name = groupInput.value.trim();
  if (!name) return alert("Adj meg nevet!");
  if (data[name]) return alert("Ilyen szÃ³csoport mÃ¡r lÃ©tezik!");
  data[name] = [];
  save();
  refreshGroups();
  groupSelect.value = name;
  groupInput.value = "";
};

document.getElementById("addWordBtn").onclick = () => {
  const g = groupSelect.value;
  if (!g) return alert("Nincs kivÃ¡lasztott szÃ³csoport!");
  const f = foreignInput.value.trim();
  const h = huInput.value.trim();
  if (!f || !h) return;
  data[g].push({ foreign: f, hu: h });
  save();
  foreignInput.value = "";
  huInput.value = "";
  renderWords();
};

document.getElementById("startBtn").onclick = startPlayback;
document.getElementById("pauseBtn").onclick = () => {
  paused = true;
  speechSynthesis.pause();
};
document.getElementById("resumeBtn").onclick = () => {
  paused = false;
  speechSynthesis.resume();
};
document.getElementById("stopBtn").onclick = () => {
  playing = false;
  paused = false;
  speechSynthesis.cancel();
};

groupSelect.onchange = renderWords;

/* ===== INDULÃS ===== */
refreshGroups();
</script>

</body>
</html>
