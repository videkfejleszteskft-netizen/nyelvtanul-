<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nyelvtanul√≥</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  padding: 20px;
}
input, textarea, select, button {
  width: 100%;
  padding: 12px;
  margin-top: 8px;
  font-size: 16px;
}
textarea { height: 110px; }
button {
  background: #007AFF;
  color: white;
  border: none;
  border-radius: 8px;
}
button.secondary {
  background: #888;
}
.section {
  margin-top: 24px;
  padding-top: 10px;
  border-top: 1px solid #ccc;
}
</style>
</head>

<body>

<h2>üìÅ Sz√≥csoport</h2>
<input id="groupName" placeholder="√öj sz√≥csoport neve">
<button onclick="createGroup()">Sz√≥csoport l√©trehoz√°sa</button>

<select id="groupSelect"></select>

<div class="section">
<h3>‚ûï Egy sz√≥</h3>
<input id="foreign" placeholder="Idegen sz√≥">
<input id="hu" placeholder="Magyar jelent√©s">
<button onclick="addSingle()">Hozz√°ad√°s</button>
</div>

<div class="section">
<h3>üìã T√∂meges bevitel</h3>
<textarea id="bulk" placeholder="andare - menni"></textarea>
<button onclick="addBulk()">Szavak hozz√°ad√°sa</button>
</div>

<div class="section">
<h3>‚ñ∂Ô∏è Lej√°tsz√°s</h3>
<input id="delay" type="number" value="3" placeholder="Sz√ºnet (mp)">
<input id="repeat" type="number" value="3" placeholder="Ism√©tl√©s">
<button onclick="start()">START</button>
<button class="secondary" onclick="pause()">PAUSE</button>
<button class="secondary" onclick="resume()">RESUME</button>
<button class="secondary" onclick="stop()">STOP</button>
</div>

<script>
/* ===== ADAT ===== */
let store = JSON.parse(localStorage.getItem("groups") || "{}");
let playing = false;
let paused = false;

/* ===== AUDIO ===== */
let ctx, leftGain, rightGain, noise;

function initAudio() {
  ctx = new (window.AudioContext || window.webkitAudioContext)();

  const buffer = ctx.createBuffer(1, ctx.sampleRate * 2, ctx.sampleRate);
  const d = buffer.getChannelData(0);
  for (let i = 0; i < d.length; i++) d[i] = (Math.random()*2-1)*0.04;

  noise = ctx.createBufferSource();
  noise.buffer = buffer;
  noise.loop = true;

  leftGain = ctx.createGain();
  rightGain = ctx.createGain();
  leftGain.gain.value = 0.12;
  rightGain.gain.value = 0.05;

  const split = ctx.createChannelSplitter(2);
  const merge = ctx.createChannelMerger(2);

  noise.connect(split);
  split.connect(leftGain,0);
  split.connect(rightGain,0);
  leftGain.connect(merge,0,0);
  rightGain.connect(merge,0,1);
  merge.connect(ctx.destination);

  noise.start();
}

function focusLeft() {
  leftGain.gain.setTargetAtTime(0.16, ctx.currentTime, 1);
  rightGain.gain.setTargetAtTime(0.03, ctx.currentTime, 1);
}
function focusRight() {
  leftGain.gain.setTargetAtTime(0.03, ctx.currentTime, 1);
  rightGain.gain.setTargetAtTime(0.16, ctx.currentTime, 1);
}

/* ===== SEG√âD ===== */
function save() {
  localStorage.setItem("groups", JSON.stringify(store));
}
function refreshGroups() {
  groupSelect.innerHTML = "";
  Object.keys(store).forEach(g => {
    const o = document.createElement("option");
    o.value = g; o.textContent = g;
    groupSelect.appendChild(o);
  });
}
refreshGroups();

function current() {
  return groupSelect.value;
}

/* ===== BEVITEL ===== */
function createGroup() {
  const n = groupName.value.trim();
  if (!n || store[n]) return;
  store[n] = [];
  save();
  refreshGroups();
  groupSelect.value = n;
  groupName.value = "";
}

function addSingle() {
  if (!current()) return alert("Nincs sz√≥csoport!");
  if (!foreign.value || !hu.value) return;
  store[current()].push({ f: foreign.value, h: hu.value });
  save();
  foreign.value = hu.value = "";
}

function addBulk() {
  if (!current()) return alert("Nincs sz√≥csoport!");
  bulk.value.split("\n").forEach(l => {
    const p = l.split(/[-=‚Äì\t]/);
    if (p.length >= 2) {
      store[current()].push({ f: p[0].trim(), h: p.slice(1).join("-").trim() });
    }
  });
  bulk.value = "";
  save();
}

/* ===== HANG ===== */
function speak(t, lang) {
  return new Promise(r => {
    const u = new SpeechSynthesisUtterance(t);
    u.lang = lang;
    u.onend = r;
    speechSynthesis.speak(u);
  });
}
function wait(s) {
  return new Promise(async r => {
    while (paused) await new Promise(x=>setTimeout(x,200));
    setTimeout(r, s*1000);
  });
}

/* ===== LEJ√ÅTSZ√ÅS ===== */
async function start() {
  const g = current();
  if (!g) return alert("Nincs sz√≥csoport!");
  if (store[g].length === 0) return alert("A sz√≥csoport √ºres!");

  playing = true; paused = false;
  if (!ctx) initAudio();
  await ctx.resume();

  const d = Number(delay.value);
  const r = Number(repeat.value);

  for (let w of store[g]) {
    if (!playing) break;

    for (let i=0;i<r;i++) {
      focusLeft(); await speak(w.f,"it-IT"); await wait(d);
      focusRight(); await speak(w.h,"hu-HU"); await wait(d);
    }
    for (let i=0;i<r;i++) {
      focusRight(); await speak(w.f,"it-IT"); await wait(d);
      focusLeft(); await speak(w.h,"hu-HU"); await wait(d);
    }
  }
}

function pause() {
  paused = true;
  speechSynthesis.pause();
}
function resume() {
  paused = false;
  speechSynthesis.resume();
}
function stop() {
  playing = false;
  paused = false;
  speechSynthesis.cancel();
}
</script>

</body>
</html>
